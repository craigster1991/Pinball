function downHandler(e,t){isMouseDown=true;moveHandler(e,t)}function upHandler(e,t){isMouseDown=false;mouseX=undefined;mouseY=undefined}function moveHandler(e,t){mouseX=(e-canvasPosition.x)/30;mouseY=(t-canvasPosition.y)/30}function getBodyAtMouse(){mousePVec=new b2Vec2(mouseX,mouseY);var e=new b2AABB;e.lowerBound.Set(mouseX-.001,mouseY-.001);e.upperBound.Set(mouseX+.001,mouseY+.001);selectedBody=null;world.QueryAABB(getBodyCB,e);return selectedBody}function getBodyCB(e){if(e.GetBody().GetType()!=b2Body.b2_staticBody){if(e.GetShape().TestPoint(e.GetBody().GetTransform(),mousePVec)){selectedBody=e.GetBody();return false}}return true}function getElementPosition(e){var t=e,n="",r=0,i=0;while(typeof t=="object"&&typeof t.tagName!="undefined"){i+=t.offsetTop;r+=t.offsetLeft;n=t.tagName.toUpperCase();if(n=="BODY")t=0;if(typeof t=="object"){if(typeof t.offsetParent=="object")t=t.offsetParent}}return{x:r,y:i}}function updateMouseDrag(){if(isMouseDown&&!mouseJoint){var e=getBodyAtMouse();if(e){var t=new b2MouseJointDef;t.bodyA=world.GetGroundBody();t.bodyB=e;t.target.Set(mouseX,mouseY);t.collideConnected=true;t.maxForce=300*e.GetMass();mouseJoint=world.CreateJoint(t);e.SetAwake(true)}}if(mouseJoint){if(isMouseDown){mouseJoint.SetTarget(new b2Vec2(mouseX,mouseY))}else{world.DestroyJoint(mouseJoint);mouseJoint=null}}}var mouseX,mouseY,mousePVec,isMouseDown,selectedBody,mouseJoint;var canvasPosition=getElementPosition(document.getElementById("canvas"));var mouse=MouseAndTouch(document,downHandler,upHandler,moveHandler)